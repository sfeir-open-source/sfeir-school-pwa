<!DOCTYPE html>
<html lang="en" ng-app="peopleApp">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#020307" />
    <title>Sfeir People</title>

    <link rel="stylesheet" href="/css/material-icons.css" />
    <link rel="stylesheet" href="/mdl/material.min.css" />
    <link rel="stylesheet" href="css/md-overwrite.css" />
    <link rel="shortcut icon" href="/img/favicon.ico" />
    <script src="/mdl/material.min.js"></script>
  </head>

  <body>
    <!-- Always shows a header, even in smaller screens. -->
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <span class="mdl-layout-title">
            <a href="/home">
              <img src="/img/logo-app.png" aria-label="People" alt="People" />
            </a>
          </span>
          <div class="mdl-layout-spacer"></div>
          <nav class="mdl-navigation">
            <a href="/people"><i class="material-icons">list</i></a>
          </nav>
        </div>
      </header>
      <main class="mdl-layout__content">
        <div class="page-content">
          <div id="root">
            <people-app></people-app>
            <dialog id="dialog" class="mdl-dialog">
              <div class="mdl-dialog__content">
                <span>a new version is available</span>
              </div>
              <div class="mdl-dialog__actions">
                <button type="button" class="mdl-button">Reload</button>
              </div>
            </dialog>
          </div>
        </div>
      </main>
    </div>

    <script>
      const dialog = document.querySelector('#dialog');

      if (navigator.serviceWorker) {
        navigator.serviceWorker.register('service-worker.js')
        .then(registration => {
          registration.addEventListener('updatefound', _=> {
            registration.installing.addEventListener('statechange', _=> {
              if (registration.waiting) {
                dialog.showModal();
              }
            });
          });
        });
      }

      navigator.serviceWorker.addEventListener('message', event => {
        if (event.data.action === "RELOAD_WINDOW") {
          window.location.reload();
        }
      });

      dialog.querySelector('button').addEventListener('click', _=> {
        dialog.close();
        navigator.serviceWorker.controller.postMessage({action: 'SKIP_WAITING'})
      }, {once: true});

    </script>
  </body>
</html>
